<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Apidev 专注于开发者所需的接口工具，支持开发者的创新</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="edge">
<meta http-equiv="Expires" content="0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Cache-control"
	content="no-cache, no-store, must-revalidate">
<meta http-equiv="Cache" content="no-cache">

<meta http-equiv="Cache" content="no-cache">
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="keywords" content="接口开发 技术文档 开发工具">
<meta name="description"
	content="一个非常适合IT团队的API开发工具、技术文档开发工具。Apidev专注于开发者所需的接口工具，支持开发者的创新">
<link rel="stylesheet" href="#(path)/assets/lib/layui_exts/mouseRightMenu/mouseRightMenu.css" />
<link rel="stylesheet" href="#(path)/assets/lib/layui-v2.9.14/layui/css/layui.css" media="all" />
<script src="#(path)/assets/lib/layui-v2.9.14/layui/layui.js" type="text/javascript"></script>
<style type="text/css">
	.layui-colla-content {
	    color: #333333eb;
	}
	.layui-colla-content, .layui-colla-item1 {
		border-color: #eee;
    	border-top-width: 1px;
    	border-top-style: solid;
 }
</style>
<link id="layui_theme_css" rel="stylesheet">
<style type="text/css">
.layui-row {
		 border-radius: 10px;
}
h3 {
	margin-bottom: 10px;
}

.item-group {
	width: 100px;
	text-align: center;
}

.item-group i {
	font-size: 20px;
}

.item-group-text {
	margin-top: -12px;
	margin-bottom: 25px;
}

.layui-layout-admin .layui-body {
	top: 0px;
	left: 100px;
}

.layui-layout-admin .layui-header, .layui-layout-admin .layui-logo,
	.layui-layout-admin .layui-side {
	width: 100px;
}

.layui-layout-admin .layui-footer {
	left: 100px;
}

.layui-card {
	margin-bottom: 0px;
}

iframe {
	border: 0;
}

.layui-tab-content {
	padding: 15px 10px;
}

.layui-elem-quote {
	margin-bottom: 0px;
}

.layui-card-body {
	padding: 0;
}

.layui-elem-quote {
	border-left: 0;
	padding: 10px;
	background-color: initial;
}

.layui-colla-title {
	background-color: initial;
}

.body-left {
	border-right: 1px solid #ccc;
	height: calc(100vh - 3px);
	overflow-y: auto;
	overflow-x: none;
}

.body-right {
	height: calc(100vh - 3px);
	overflow: auto;
}

.add-btn {
	top: 53px;
	right: 15px;
	position: absolute;
}

.add-btn:hover {
	cursor: pointer; /* 设置鼠标光标为手形 */
	background-color: #607d8b54;
}

.menu-icon {
	top: 0px;
	right: 0px;
	position: absolute;
	display: none;
}

.layui-colla-title:hover>.menu-icon {
	display: block;
}

.menu-icon i {
	margin-right: 5px;
}

.tab-icon {
	display: flex; /* 使用Flexbox排布 */
	align-items: center; /* 垂直居中对齐 */
	margin-left: 10px; /* 让图标和tabs之间有一点间隙 */
}

.layui-form-onswitch, .layui-form-switch {
	border-color: #d2d2d2;
	background-color: #2f363c;
}

.POST {
	color: #c50101;
	padding: 0px 2px 0px 0px;
}

.DEL {
	color: #c50101;
	padding: 0px 12px 0px 0px;
}

.GET {
	color: #11ab11;
	padding: 0px 11px 0px 0px;
}

.PUT, .OPT {
	color: #0f85df;
	padding: 0px 11px 0px 0px;
}

.HEAD {
	color: #0f85df;
	padding: 0px 2px 0px 0px;
}

#colla_content, #colla_title, .layui-colla-content {
	padding-right: 0;
}

#tree-container {
	margin-left: 0px;
}

ul {
	list-style-type: none;
	padding-left: 10px;
	cursor: pointer;
}

.children,.layui-table-tool {
	display: none; /* 初始隐藏子节点 */
}

.icon {
	display: inline-block;
	margin-left: -16px;
	font-size: 14px;
}

.down {
	transform: rotate(90deg);
}

.right {
	transform: rotate(0deg);
}

.tree-node li {
	padding: 0px 0px 0px 5px;
}

.tree-node-title {
	padding: 5px 15px 5px 15px;
	margin: 0.5px;
	white-space: nowrap; /* 不允许换行 */
	overflow: hidden; /* 隐藏超出部分 */
	text-overflow: ellipsis; /* 超出部分显示省略号 */
}

.tree-node-title:hover>.layui-icon-more {
	visibility: visible; /* 悬浮时图标可见 */
	display: block;
}

.tree-node-title .layui-icon-more {
	visibility: hidden; /* 默认隐藏 */
	float: right;
	position: absolute;
	display: none;
	right: 5px;
	margin-top: -22px;
}

.active, .tree-node-title:hover, 
.layui-colla-title:hover, 
.item-group .layui-this,
.layui-menu .layui-menu-item-group>.layui-menu-body-title:hover
{
	background-color: #607d8b54 !important; /* 活动节点样式 */
}
ul.layui-dropdown-menu i:hover,a:hover{
	cursor: pointer; /* 设置鼠标光标为手形 */
}
.layui-menu-body-title{
	padding-left: 30px;
}

.layui-menu-body-title>.layui-icon {
    left: 0px;
}
.layui-menu-body-title>.layui-icon-export {
    left: 15px;
} 
.layui-menu .layui-menu-item-group>.layui-menu-body-title {
	color:var(--lay-color-text-3);
}
.td-title{
	padding-left:15px;
	color:#817a7ad4;
}
.layui-table-tool-temp {
    padding-right: 0px;
}

</style>

</head>
<body>
	<div class="layui-layout layui-layout-admin">
		<div class="layui-header">
			<div class="layui-logo layui-bg-black">
				<a href="http://apidev.cn" target="_blank" style="color: #fff">Apidev</a>
			</div>
		</div>
		<div class="layui-side layui-bg-black">
			<div class="layui-side-scroll">
				<!-- 左侧导航区域（可配合layui已有的垂直导航） -->
				<ul class="layui-nav layui-nav-tree" lay-filter="test">
					<li class="layui-nav-item layui-nav-itemed">
						<div class="item-group">
							<i class="layui-icon layui-icon-survey"></i> <a
								class="item-group-text" href="javascript:;">接口管理</a>
						</div>
					</li>
					<li class="layui-nav-item">
						<div class="item-group">
							<i class="layui-icon layui-icon-share"></i> <a
								class="item-group-text" href="javascript:;">分享文档</a>
						</div>
					</li>
					<li class="layui-nav-item">
						<div class="item-group">
							<i class="layui-icon layui-icon-set"></i> <a
								class="item-group-text" href="javascript:;">项目设置</a>
						</div>
					</li>
					<li class="layui-nav-item" title="背景主题">
						<div class="item-group layui-form">
							<i id="themeIcon" class="layui-icon layui-icon-light"></i>
							<div class="layui-form-item" style="margin-top: -15px">
								<input id="switchTheme" type="checkbox" lay-skin="switch"
									lay-filter="switchTheme" title="暗|亮">
							</div>
						</div>
					</li>
				</ul>
			</div>
		</div>
		<div class="layui-body">
			<!-- 内容主体区域 -->

			<div class="layui-card layui-panel">
				<div class="layui-card-body">
					<div class="layui-row" style="border: 1px solid #ccc;">
						<div class="layui-col-xs12 layui-col-sm4 layui-col-md3 body-left">
							<blockquote class="layui-elem-quote layui-text">
								<h3>接口管理</h3>
								<div class="layui-form layui-input-wrap" style="width: 85%">
									<div class="layui-input-prefix">
										<i class="layui-icon layui-icon-search"></i>
									</div>
									<input type="text" name="keyword" lay-affix="clear"
										class="layui-input" onblur="search()" oninput="search()">
								</div>
								<div class="add-btn">
									<i class="layui-icon layui-icon-addition"
										style="font-size: 22px;"></i>
								</div>
							</blockquote>
							<!-- 折叠面板 start-->
							<div class="layui-collapse">

								<div class="layui-colla-item1 project">
									<div class="layui-colla-title active">
										项目概况<i class="layui-icon layui-icon-layouts layui-colla-icon"></i>
									</div>
								</div>

								<div class="layui-colla-item">
									<div id="colla_title" class="layui-colla-title">
										接口
										<div class="menu-icon">
											<i class="layui-icon layui-icon-eye-invisible layui-icon-eye"
												title="展开目录"
												onclick="openAllTree(event,this,'tree-container')"></i> <i
												class="layui-icon layui-icon-more colla-title-more api"></i>
										</div>
									</div>
									<div id="colla_content" class="layui-colla-content layui-show">
										<div id="tree-container"></div>
									</div>
								</div>

								<div class="layui-colla-item">
									<div id="colla_title_link" class="layui-colla-title">
										快捷请求
										<div class="menu-icon">
											<i class="layui-icon layui-icon-eye-invisible layui-icon-eye"
												title="展开目录"
												onclick="openAllTree(event,this,'link-container')"></i> <i
												class="layui-icon layui-icon-more colla-title-more req"></i>
										</div>
									</div>
									<div id="colla_content_link" class="layui-colla-content">
										<div id="link-container"></div>
									</div>
								</div>
								
								<div class="layui-colla-item1 recycle">
									<div class="layui-colla-title">
										回收站<i class="layui-icon layui-icon-delete layui-colla-icon"></i>
									</div>
								</div>

							</div>
							<!-- 折叠面板 end -->
						</div>
						<div class="layui-col-xs12 layui-col-sm8 layui-col-md9 body-right">
							<div class="layui-tab" lay-filter="tab-handle"
								lay-allowclose="true">
								<ul class="layui-tab-title">
								</ul>
								<!-- <span class="tab-icon">
						<i class="layui-icon layui-icon-addition"></i>
					  	<i class="layui-icon layui-icon-more"></i>
					  </span> -->
								<div class="layui-tab-content"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="layui-footer" style="display: none">
			<!-- 底部固定区域 -->
			底部固定区域
		</div>
	</div>

	<script>

//JS 
  // 缓存接口数据，用于查询
  var treeData = [];
  var linkData = [];
  var menuData = []; 
  // 回收站数据
  var apiData = [];  
  var shortcutData = [];  
  var titleKeyword = '';
  var element = layui.element;
  var layer = layui.layer;
  var util = layui.util;
  var $ = layui.$;
  var mouseRightMenu;
  var form = layui.form;
  var height=window.innerHeight-80;
  var openAll = false;
  var openAllLink = false;

  layui.config({base: '#(path)/assets/lib/layui_exts/mouseRightMenu/'});
  layui.use(['mouseRightMenu'], function(){
  	mouseRightMenu = layui.mouseRightMenu;
	 // 接口树
  	 getApiTreeList("-1");
	 // 快捷请求树
  	 getApiTreeList("-2");

  	project();
  });
  
  // 设置主题
  document.addEventListener("DOMContentLoaded", function() {  
	  var checked=localStorage.getItem("layui_theme_css");
	  tabTheme(checked);
  });  

  layui.form.on('switch(switchTheme)', function(data){
	  localStorage.setItem("layui_theme_css",this.checked);	
	  tabTheme(this.checked);
 });
  
  
  // 获取接口数
  function getApiTreeList(parentId){
	$.ajax({
		url:'#(path)/apidev/api/getTreeList',
		type:'POST',
		data:{"parentId":parentId},
		success:function(ret){
			if(ret.state=='ok'){
			  var divId="tree-container";
			  if(parentId=="-1"){
				  treeData = ret.data; 
				  loadTree(treeData,true,divId);
			  }else {
				  linkData = ret.data;
				  divId="link-container";
				  loadTree(linkData[0].children,false,divId);
			  }				  
			  
			}
		}
	});
  }

  // 重新渲染tree
  function loadTree(data,isFirst,divId){
	  $('#'+divId).html(createTree(data,isFirst,divId));
	  bingLeftMenu(divId);
	  bindRightMenu(divId);
  }

	// 创建树形菜单  
    function createTree(data,isFirst,divId) { 
        if(data==undefined) 
            return '';
        
    	var html = '';  
    	var display = data[0] && data[0].isopen ? 'block' : 'none';
    	
    	if(openAll && divId=='tree-container')
        	display = 'block';
    	if(openAllLink && divId=='link-container')
    		display = 'block';
		
        if(isFirst){
        	html = `<ul class="tree-root">`;  
        }else{
        	html = `<ul class="children" style="display: ${display}">`;  
         }
        // 循环节点
        data.forEach(node => {  
        	var hasChildren = node.children && node.children.length > 0;  
            var iconClass = hasChildren && !isFirst ? 'icon right' : 'icon down';  
            if(openAll  && divId=='tree-container')
            	iconClass = 'icon down';
        	if(openAllLink && divId=='link-container')
        		iconClass = 'icon down';
        	// 创建节点
            html += `<li class="tree-node"><div title="${node.title} ${node.type=='api' ? node.action_key : ''}" onclick="toggleNode(event, this,'${divId}')" data-id="${node.id}" class="tree-node-title">`; 
            // 子节点数量    		
            var subNodeNum = node.children && node.children.length>0 ?  '（'+node.children.length+'）' : '';
            // 节点前面图标
            if(node.type=='menu'){ // 目录
                if(hasChildren)
            		html += `<i class=" layui-icon layui-icon-right ${iconClass}" onclick="toggleRightIcon(event, this)"></i>`; 
            	html += `<i class="layui-icon layui-icon-export" style="padding-right:2px"></i>`;
            	if(subNodeNum=='')
            		subNodeNum='（0）';
            } else if(node.type=='api' || node.type == 'link'){ // 接口
                 if(node.request_mode){
	             	html += `<span class="${node.request_mode}">${node.request_mode}</span>`;
	             } else {
	    			html += `<span class="GET">GET</span>`;
	    		 }
            } else if(node.type=='demo'){ // 用例
            	html += `<i class="layui-icon layui-icon-link"></i>`;
            }
            // 节点名称、更多图标
            html +=`<span>${node.title}${subNodeNum}</span><i data-id="${node.id}" class="layui-icon layui-icon-more tree-menu-more  ${divId}-${node.id=='-1' ? 'root' : node.type}"></i></div>`;  
			// 递归创建子节点
            if (hasChildren) {
                html += createTree(node.children,false,divId);  
            }  

            html += `</li>`;     
        });  

        html += `</ul>`;  
        return html;  
    }  

	// 父级目录选择树
    function createDownMenuTree(data,isFirst){
    	if(data==undefined) 
            return '';
    	var display = data[0] && data[0].isopen ? 'block' : 'none';
    	var html = '';  
        if(isFirst){
        	html = `<ul class="layui-menu layui-dropdown-menu">`;  
        }else{
        	html = `<ul class="children" style="display: ${display}">`;  
         }
        var iconClass = isFirst ? 'layui-icon-down' : 'layui-icon-right';  
     // 循环节点
        data.forEach(node => {  
        	var hasChildren = node.children && node.children.length > 0;  
            
        	// 创建节点
            html += `<li class="layui-menu-item-group" id="${node.id}"><div class="layui-menu-body-title" data-id="${node.id}">`; 	
            // 节点前面图标
            if(node.type=='menu'){ // 目录
                if(hasChildren)
            		html += `<i onclick="toggleNodeMenu(event, this)" class="layui-icon ${iconClass}"></i>`; 
            	html += `<i class="layui-icon layui-icon-export"></i>`;
            }
            // 节点名称
            html +=`${node.title}</div>`;  
			// 递归创建子节点
            if (hasChildren) {
                html += createDownMenuTree(node.children,false);  
            }  

            html += `</li>`;     
        });  

        html += `</ul>`;  
        return html;  
    }

   // 切换节点显示和隐藏  
    function toggleNode(event,_this,divId) {  
        event.stopPropagation(); 
     	// 移除其他节点的活动样式  
        const activeNodes = document.querySelectorAll('.active');  
        activeNodes.forEach(node => node.classList.remove('active'));  

        // 设置当前节点为活动  
        _this.classList.add('active');
        
        const childrenUl = _this.parentNode.querySelector('ul.children');  
        const icon = _this.querySelector('.icon');  
        
        // 获取节点 ID 并显示  
        const nodeId = _this.getAttribute('data-id');
        var nodeData;
        if(divId=='tree-container') {
        	nodeData = findNodeById(treeData[0], nodeId);
        }else{
        	nodeData = findNodeById(linkData[0], nodeId);
        }
        
        var title = '';  
        if(nodeData.type=='menu'){
			title='<i class="layui-icon layui-icon-export"></i>';
        }else{
            var mode=nodeData.request_mode||'GET';
        	title='<span class="'+mode+'">'+mode+'</span>'
        }
        
        var li=$('li[lay-id='+nodeId+']');
		if(li.length>0){
			element.tabChange('tab-handle', nodeId); // 切换到标签
			if (childrenUl) {
	            const isExpanded = childrenUl.style.display === 'block';  
	            childrenUl.style.display = isExpanded ? 'none' : 'block';  
	            icon.classList.toggle('right', isExpanded);  
	            icon.classList.toggle('down', !isExpanded);  
	        }  
		}else{
			// 显示在右侧tab
	        clickMenu(nodeData.id,title+nodeData.title); 
		}
    }  

    function toggleNodeMenu(event,_this){
    	event.stopPropagation();         
        const childrenUl = _this.parentNode.parentNode.querySelector('ul.children');  

        // 获取节点 
        if (childrenUl) {
            const isExpanded = childrenUl.style.display === 'block';  
            childrenUl.style.display = isExpanded ? 'none' : 'block';  
            if(!isExpanded){
                _this.classList.remove("layui-icon-right"); 
                _this.classList.add("layui-icon-down"); 
            }else{
            	 _this.classList.add("layui-icon-right"); 
                 _this.classList.remove("layui-icon-down"); 
             }
        }   
    }

    // 接口树点击图标
    function toggleRightIcon(event,_this){
    	event.stopPropagation();         
        const childrenUl = _this.parentNode.parentNode.querySelector('ul.children');  

        // 获取节点 
        if (childrenUl) {
            const isExpanded = childrenUl.style.display === 'block';  
            childrenUl.style.display = isExpanded ? 'none' : 'block';  
            _this.classList.toggle('right', isExpanded);  
            _this.classList.toggle('down', !isExpanded);  
        }
    }


  // 展开全部
  function openAllTree(event, _this, divId){
	  event.stopPropagation(); 
	  if(divId=='tree-container'){
		  var doc=document.getElementById('colla_content');
	
		  if(!doc.classList.contains('layui-show')){
			  $('#colla_title').click();
			  openAll = false;
		  }
		  if(!openAll){
			  openAll = true;
			  _this.title='收起目录';
			  _this.classList.remove('layui-icon-eye-invisible');
			  _this.classList.add('layui-icon-eye'); 
		  }else{
	 		  openAll = false;
	 		 _this.title='展开目录';
	 		_this.classList.add('layui-icon-eye-invisible');
	 		_this.classList.remove('layui-icon-eye');
	  	}
	  	loadTree(treeData,true,divId);
	  }else{
		  var docLink=document.getElementById('colla_content_link');
		  if(!docLink.classList.contains('layui-show')){
			  $('#colla_title_link').click();
			  openAllLink = false;
		  }

		  if(!openAllLink){
			  openAllLink = true;
			  _this.title='收起目录';
			  _this.classList.remove('layui-icon-eye-invisible');
			  _this.classList.add('layui-icon-eye'); 
		  }else{
			  openAllLink = false;
	 		 _this.title='展开目录';
	 		_this.classList.add('layui-icon-eye-invisible');
	 		_this.classList.remove('layui-icon-eye');
	  	}
		  
		  loadTree(linkData[0].children,false,divId);
	  }

	  
 }

  // 接口菜单点击事件
  function clickMenu(id,title,content){
	  if(!content)
		  content=`<iframe width="100%" height="${height}px"  src="${id}"></iframe>`;
		// 定义要查找的lay-id值
		var li=$('li[lay-id='+id+']');
		if(li.length>0){
			element.tabChange('tab-handle', id); // 切换到标签
		}else{
			element.tabAdd('tab-handle', {
		        title: title,
		        content: content,
		        id: id,
		        change: true // 是否添加完毕后即自动切换
		    });
		}
		bindTabRightMenu();
	}

  	// tab导航右键菜单
	function bindTabRightMenu(){
		$('.layui-tab-title li').off("contextmenu");
		//右键目录菜单
		$('.layui-tab-title li').bind("contextmenu",function(e){
			var id=$(this).attr('lay-id');
			var data = {menuId:id}
			var menu_data=[
				{'data':data,'type':'closeTab','title':'关闭当前标签','icon':'layui-icon-close'},
				{'data':data,'type':'closeOtherTabs','title':'关闭其它标签','icon':'layui-icon-error'},
				{'data':data,'type':'closeAllTabs','title':'关闭全部标签','icon':'layui-icon-close-fill'},
			]
			mouseRightMenu.open(menu_data,false,function(d){
				var menuId=d.data.menuId;
				if(d.type=='closeTab'){
					element.tabDelete('tab-handle', menuId); 
		 		} else if(d.type=='closeOtherTabs'){
		 			$('.layui-tab-title li').each(function() {  
			 			if($(this).attr('lay-id')!=menuId){
			        	  	element.tabDelete('tab-handle', $(this).attr('lay-id'));  
			 			}
			        }); 
		 	 	} else if(d.type=='closeAllTabs'){
		 	 		$('.layui-tab-title li').each(function() {  
			        	  element.tabDelete('tab-handle', $(this).attr('lay-id')); 
			         }); 
		 	 	}
			})
			return false;
		});
		
	}

  	// 选项卡右键菜单
	function bindRightMenu(){
		bindTabRightMenu();			
		 $('.tree-node i.tree-menu-more').off("click").on("click", function(e) {  
			  event.stopPropagation(); 
			  var dataId=$(this).attr("data-id");
			  var nodeData=findNodeById(treeData[0],dataId);
			  
		 }); 
	}

	// 树更多操作菜单
	function bingLeftMenu(){

		// 接口根目录更多操作
		layui.dropdown.render({
		    elem: '.tree-container-root', // 绑定元素选择器，此处指向 class 可同时绑定多个元素
		    trigger:'hover',
		    data: [{
		      title: '添加子目录',
		      id: 'addApiSubMenu',
		      templet: function(d){
		    	  return '<i class="layui-icon layui-icon-file"></i> ' + d.title;
		      }
		    },{
		      title: '添加接口',
		      id: 'addApi',
		      templet: function(d){
		    	  return '<i class="layui-icon layui-icon-link"></i> ' + d.title;
		      }
		    },{
		      title: '导出',
		      id: 'export',
		      templet: function(d){
		    	  return '<i class="layui-icon layui-icon-export" style="margin-left:-15px"></i> ' + d.title;
		      }
		    }],
		    click: function(obj){
		      	var type=obj.id;
		      	var title = obj.title;
		      	var id=new Date().getTime();
 	 			var parentId="-1";
 	 			if(type=='addApiSubMenu'){
 	 				addMenu(parentId,'-1');
 	 	 	 	} else 	if(type=='addApi'){
 	 				element.tabAdd('tab-handle', {
 	 			        title: '<span class="GET">GET</span>新建接口',
 	 			        content: '<iframe width="100%" height="'+height+'px"  src="'+id+'"></iframe>',
 	 			        id: id,
 	 			        change: true // 是否添加完毕后即自动切换
 	 			    });
 	 				bindRightMenu();
 	 	 		} else if(type=='export'){
 	 	 			download(parentId)
 	 	 	 	}
		    }
		  });


		// 接口目录更多操作
		layui.dropdown.render({
		    elem: '.tree-container-menu', // 绑定元素选择器，此处指向 class 可同时绑定多个元素
		    trigger:'hover',
		    data: [
		    {
		      title: '添加接口',
		      id: 'addApi',
		      templet: function(d){
		    	  return '<i class="layui-icon layui-icon-link"></i> ' + d.title;
		      }
		    },{
			      title: '重命名',
			      id: 'rename',
			      templet: function(d){
			    	  return '<i class="layui-icon layui-icon-edit"></i> ' + d.title;
			      }
		    },{
			      title: '复制',
			      id: 'copy',
			      templet: function(d){
			    	  return '<i class="layui-icon layui-icon-templeate-1"></i> ' + d.title;
			      }
		    },{
			      title: '移动到',
			      id: 'moveTo',
			      templet: function(d){
			    	  return '<i class="layui-icon layui-icon-next"></i> ' + d.title;
			      }
		    },{
		      title: '添加子目录',
		      id: 'addApiSubMenu',
		      templet: function(d){
		    	  return '<i class="layui-icon layui-icon-export" style="margin-left:-15px"></i> ' + d.title;
		      }
		    },{
		      title: '导出',
		      id: 'export',
		      templet: function(d){
		    	  return '<i class="layui-icon layui-icon-download-circle"></i> ' + d.title;
		      }
		    },{
			      title: '删除',
			      id: 'del',
			      templet: function(d){
			    	  return '<i class="layui-icon layui-icon-delete"></i> ' + d.title;
			      }
		    }],
		    click: function(obj){
		      	var type=obj.id;
		      	var dataId=$(this.elem).attr('data-id');
				var treeNode=findNodeById(treeData[0],dataId);
				var id=new Date().getTime();
				// 添加接口
				if(type=='addApi'){
 	 	 	 		element.tabAdd('tab-handle', {
	 			        title: '<span class="GET">GET</span>新建接口',
	 			        content: '<iframe width="100%" height="'+height+'px"  src="'+id+'"></iframe>',
	 			        id: id,
	 			        change: true // 是否添加完毕后即自动切换
	 			    });
 	 	 	 		bindTabRightMenu();
	 	 	 	} else if(type=='rename'){
	 	 	 		rename(dataId,'-1');
	 	 	 	} else if(type=='copy'){
 	 	 	 		copy(dataId,'-1');
	 	 	 	} else if(type=='moveTo'){
 	 	 	 		moveTo(dataId,'-1');
				}else if(type=='addApiSubMenu'){
 	 				addMenu(dataId,'-1');
 	 	 	 	} else if(type=='export'){
 	 	 	 		download(dataId)
	 	 	 	} else if(type=='del'){
	 	 	 		del(dataId,'-1');
 	 	 	 	} 
		    }
		  });

		// 接口更多操作
		layui.dropdown.render({
		    elem: '.tree-container-api', // 绑定元素选择器，此处指向 class 可同时绑定多个元素
		    trigger:'hover',
		    data: [
		    {
		      title: '添加用例',
		      id: 'addDemo',
		      templet: function(d){
		    	  return '<i class="layui-icon layui-icon-link"></i> ' + d.title;
		      }
		    },{
			      title: '重命名',
			      id: 'rename',
			      templet: function(d){
			    	  return '<i class="layui-icon layui-icon-edit"></i> ' + d.title;
			      }
		    },{
			      title: '复制',
			      id: 'copy',
			      templet: function(d){
			    	  return '<i class="layui-icon layui-icon-templeate-1"></i> ' + d.title;
			      }
		    },{
			      title: '移动到',
			      id: 'moveTo',
			      templet: function(d){
			    	  return '<i class="layui-icon layui-icon-next"></i> ' + d.title;
			      }
		    },{
		      title: '复制链接',
		      id: 'copyLink',
		      templet: function(d){
		    	  return '<i class="layui-icon layui-icon-link"></i> ' + d.title;
		      }
		    },{
		      title: '导出',
		      id: 'export',
		      templet: function(d){
		    	  return '<i class="layui-icon layui-icon-download-circle"></i> ' + d.title;
		      }
		    },{
			      title: '删除',
			      id: 'del',
			      templet: function(d){
			    	  return '<i class="layui-icon layui-icon-delete"></i> ' + d.title;
			      }
		    }],
		    click: function(obj){
		      	var type=obj.id;
		      	var dataId=$(this.elem).attr('data-id');
				var treeNode=findNodeById(treeData[0],dataId);
				var id=new Date().getTime();
				if(type=='addDemo'){
	 	 	 		layer.alert("添加用例")
	 	 	 	} else  if(type=='rename'){
	 	 	 	 	rename(dataId,'-1');
	 	 	 	} else if(type=='copy'){
	 	 	 		copy(dataId,'-1');
	 	 	 	} else if(type=='moveTo'){
	 	 	 		moveTo(dataId,'-1');
 	 	 	 	} else if(type=='copyLink'){
 	 	 	 		layer.alert("复制链接")
	 	 	 	} else if(type=='addApiSubMenu'){
 	 				addMenu(parentId,'-1');
 	 			}else if(type=='coypLink'){
 	 				//addMenu(dataId,'-2');
 	 	 	 	} else if(type=='export'){
 	 	 	 		download(dataId)
	 	 	 	} else if(type=='del'){
	 	 	 		del(dataId,'-1');
	 	 	 	}
		    }
		  });

		// 快捷请求目录更多操作
		layui.dropdown.render({
		    elem: '.link-container-menu', // 绑定元素选择器，此处指向 class 可同时绑定多个元素
		    trigger:'hover',
		    data: [
		    {
		      title: '新建快捷请求',
		      id: 'addLink',
		      templet: function(d){
		    	  return '<i class="layui-icon layui-icon-link"></i> ' + d.title;
		      }
		    },{
			      title: '编辑',
			      id: 'editMenu',
			      templet: function(d){
			    	  return '<i class="layui-icon layui-icon-edit"></i> ' + d.title;
			      }
		    },{
			      title: '复制',
			      id: 'copy',
			      templet: function(d){
			    	  return '<i class="layui-icon layui-icon-templeate-1"></i> ' + d.title;
			      }
		    },{
		      title: '添加子目录',
		      id: 'addLinkSubMenu',
		      templet: function(d){
		    	  return '<i class="layui-icon layui-icon-export" style="margin-left:-15px"></i> ' + d.title;
		      }
		    },{
			      title: '删除',
			      id: 'del',
			      templet: function(d){
			    	  return '<i class="layui-icon layui-icon-delete"></i> ' + d.title;
			      }
		    }],
		    click: function(obj){
		      	var type=obj.id;
		      	var dataId=$(this.elem).attr('data-id');
				var treeNode=findNodeById(linkData[0],dataId);
				var id=new Date().getTime();
				
				if(type=='addLink'){
	 	 	 	 	element.tabAdd('tab-handle', {
	 			        title: '<i class="layui-icon layui-icon-link"></i>快捷请求',
	 			        content: '<iframe width="100%" height="'+height+'px"  src="'+id+'"></iframe>',
	 			        id: id,
	 			        change: true // 是否添加完毕后即自动切换
	 			    });
 	 	 	 		bindTabRightMenu();
	 	 	 	}else if(type=='addLinkSubMenu'){
 	 				addMenu(dataId,'-2');
	 	 	 	} else if(type=='editMenu'){
	 	 	 	 	editMenu(dataId,'-2')
	 	 	 	} else if(type=='copy'){
	 	 	 		copy(dataId,'-2');
	 	 	 	} else if(type=='del'){
	 	 	 		del(dataId,'-2');
 	 	 	 	} 
		    }
		  });


		// 快捷请求更多操作
		layui.dropdown.render({
		    elem: '.link-container-link', // 绑定元素选择器，此处指向 class 可同时绑定多个元素
		    trigger:'hover',
		    data: [
		    {
			      title: '复制',
			      id: 'copy',
			      templet: function(d){
			    	  return '<i class="layui-icon layui-icon-templeate-1"></i> ' + d.title;
			      }
		    },{
			      title: '重命名',
			      id: 'rename',
			      templet: function(d){
			    	  return '<i class="layui-icon layui-icon-edit"></i> ' + d.title;
			      }
		    },{
			      title: '移动到',
			      id: 'moveTo',
			      templet: function(d){
			    	  return '<i class="layui-icon layui-icon-next"></i> ' + d.title;
			      }
		    },{
			      title: '删除',
			      id: 'del',
			      templet: function(d){
			    	  return '<i class="layui-icon layui-icon-delete"></i> ' + d.title;
			      }
		    }],
		    click: function(obj){
		      	var type=obj.id;
		      	var dataId=$(this.elem).attr('data-id');
				var treeNode=findNodeById(linkData[0],dataId);
				var id=new Date().getTime();
				if(type=='copy'){
					copy(dataId,'-2');
	 	 	 	} else if(type=='rename'){
	 	 	 	 	rename(dataId,'-2');
	 	 	 	} else if(type=='moveTo'){
	 	 	 		moveTo(dataId,'-2');
	 	 	 	} else if(type=='del'){
	 	 	 		del(dataId,'-2');
 	 	 	 	} 
		    }
		  });

		layui.dropdown.render({
		    elem: '.add-btn', // 绑定元素选择器，此处指向 class 可同时绑定多个元素
		    trigger:'hover',
		    data: [{
		      title: '新建接口',
		      id: 'addApi',
		      templet: function(d){
		    	  return '<i class="layui-icon layui-icon-file"></i> ' + d.title;
		      }
		    },{
		      title: '快捷请求',
		      id: 'addRequest',
		      templet: function(d){
		    	  return '<i class="layui-icon layui-icon-link"></i> ' + d.title;
		      }
		    },{
		      title: '新建接口目录',
		      id: 'addApiMenu',
		      templet: function(d){
		    	  return '<i class="layui-icon layui-icon-export" style="margin-left:-15px"></i> ' + d.title;
		      }
		    }],
		    click: function(obj){
		      	var type=obj.id;
		      	var title = obj.title;
		      	var id=new Date().getTime();
 	 			var parentId="-1";
 	 			if(type=='addApi'){
 	 				element.tabAdd('tab-handle', {
 	 			        title: '<span class="GET">GET</span>新建接口',
 	 			        content: '<iframe width="100%" height="'+height+'px"  src="'+id+'"></iframe>',
 	 			        id: id,
 	 			        change: true // 是否添加完毕后即自动切换
 	 			    });
 	 				bindRightMenu();
 	 	 		} else if(type=='addRequest'){
 	 	 			element.tabAdd('tab-handle', {
 	 			        title: '<i class="layui-icon layui-icon-link"></i>快捷请求',
 	 			        content: '<iframe width="100%" height="'+height+'px"  src="'+id+'"></iframe>',
 	 			        id: id,
 	 			        change: true // 是否添加完毕后即自动切换
 	 			    });
 	 				bindRightMenu();
 	 	 	 	} else if(type=='addApiMenu'){
 	 	 	 		addMenu(parentId,'-1');
 	 	 	 	}
		    }
		  });
		  
		layui.dropdown.render({
		    elem: '.api', // 绑定元素选择器，此处指向 class 可同时绑定多个元素
		    trigger:'hover',
		    data: [{
			      title: '同步接口',
			      id: 'syncApi',
			      templet: function(d){
			    	  return '<i class="layui-icon layui-icon-loading"></i> ' + d.title;
			      }
			    },{
			      title: '新建接口',
			      id: 'addApi',
			      templet: function(d){
			    	  return '<i class="layui-icon layui-icon-file"></i> ' + d.title;
			      }
			    },{
			      title: '新建目录',
			      id: 'addApiMenu',
			      templet: function(d){
			    	  return '<i class="layui-icon layui-icon-export" style="margin-left:-15px"></i> ' + d.title;
			      }
			    }
			],
		    click: function(obj){
		    	var type=obj.id;
		      	var title = obj.title;
		      	var id=new Date().getTime();
 	 			var parentId="-1";

 	 			// 更新接口
 	 			if(type=='syncApi'){
 	 				var loadIndex = layer.msg('正在同步中...', {
 	 			        icon: 16,
 	 			        shade: 0.01
 	 			      });
 	 				$.ajax({
 	 					url:'#(path)/apidev/api/sync',
 	 					type:'POST',
 	 					success:function(ret){
 	 						layer.close(loadIndex)
 	 						layer.msg(ret.msg);
 	 						if(ret.msg.indexOf("共更新接口")!=-1){
 	 							getApiTreeList();
 	 						}
 	 					}
 	 				});
 	 	 	 	} else if(type=='addApi'){
 	 	 	 		element.tabAdd('tab-handle', {
	 			        title: '<span class="GET">GET</span>新建接口',
	 			        content: '<iframe width="100%" height="'+height+'px"  src="'+id+'"></iframe>',
	 			        id: id,
	 			        change: true // 是否添加完毕后即自动切换
	 			    });
 	 	 	 		bindRightMenu();
 	 	 	 	} else if(type=='addApiMenu'){
 	 	 	 		addMenu(parentId,'-1');
 	 	 	 	}
 			}
 		});

		layui.dropdown.render({
		    elem: '.req', // 绑定元素选择器，此处指向 class 可同时绑定多个元素
		    trigger:'hover',
		    data: [{
		      title: '新建快捷请求',
		      id: 'addRequest',
		      templet: function(d){
		    	  return '<i class="layui-icon layui-icon-link"></i> ' + d.title;
		      }
		    },{
		      title: '新建目录',
		      id: 'addMenu',
		      templet: function(d){
		    	  return '<i class="layui-icon layui-icon-export" style="margin-left:-15px"></i> ' + d.title;
		      }
		    }],
		    click: function(obj){
		    	var type=obj.id;
		      	var title = obj.title;
		      	var id=new Date().getTime();
 	 			var parentId="-2";

				if(type=='addRequest'){
 	 	 	 		element.tabAdd('tab-handle', {
	 			        title: '<i class="layui-icon layui-icon-link"></i>快捷请求',
	 			        content: '<iframe width="100%" height="'+height+'px"  src="'+id+'"></iframe>',
	 			        id: id,
	 			        change: true // 是否添加完毕后即自动切换
	 			    });
 	 	 	 		bindRightMenu();
 	 	 	 	} else if(type=='addMenu'){
 	 	 	 		addMenu(parentId,'-2');
 	 	 	 	}
 			}
		});

		$('.layui-colla-title').on("click", function(e) { 
			const activeNodes = document.querySelectorAll('.active');  
	        activeNodes.forEach(node => node.classList.remove('active'));  
			$(this).addClass('active');
		});

		// 项目概况
		$('.project').on("click", function(e) { 
			project();
		});

		// 回收站
		$('.recycle').on("click", function(e) { 
			recycle();
		});
	}

	


// 搜索
function search(){
	titleKeyword = $("input[name=keyword]").val();
	 // 接口树
	var filteredData = treeData.map(filterByTitleKeyword).filter(item => item !== null);
	loadTree(filteredData,true,'tree-container');
	 // 快捷请求树
	var filteredDataLink = linkData[0].children.map(filterByTitleKeyword).filter(item => item !== null);
	loadTree(filteredDataLink,false,'link-container');
}

function tabTheme(checked){
	if(checked==true||checked=='true'){
		  // 设置为深色主题
		  document.getElementById('layui_theme_css').setAttribute('href','#(path)/assets/lib/layui-theme-dark/layui-theme-dark.css');
		  document.getElementById("switchTheme").checked = true; 
		  document.getElementById("themeIcon").classList.remove('layui-icon-light');
		  document.getElementById("themeIcon").classList.add('layui-icon-moon');
		  layui.form.render(); 
	  }else{
		  // 恢复浅色主题
		  document.getElementById('layui_theme_css').removeAttribute('href');
		  document.getElementById("themeIcon").classList.remove('layui-icon-moon');
		  document.getElementById("themeIcon").classList.add('layui-icon-light');
	 }
}

// 通过关键词过滤
function filterByTitleKeyword(node) {  
    if (!node || typeof node !== 'object') return null;  

    // 过滤子节点  
    if (Array.isArray(node.children)) {  
        const filteredChildren = node.children  
            .map(filterByTitleKeyword)  
            .filter(child => child !== null);  

        // 检查当前节点的子节点是否有匹配标题的  
        if (filteredChildren.length > 0 || (node.title && node.title.includes(titleKeyword))) {  
            return {  
                ...node,  
                children: filteredChildren.length > 0 ? filteredChildren : undefined,  
            };  
        }  
    }  

    // 返回当前节点本身如果它的标题包含关键词  
    if (node.title && node.title.includes(titleKeyword)) {  
        return node;  
    }  

    return null; // 返回 null，如果没有匹配的条目  
}  

// 通过id查找api对象
function findNodeById(node, id) {  
    if (!node) return null;  
    
    // 检查当前节点是否是目标节点  
    if (node.id === id) {  
        return node;  
    }  

    // 如果有子节点，递归查找  
    if (Array.isArray(node.children)) {  
        for (var child of node.children) {  
            const result = findNodeById(child, id);  
            if (result) {  
                return result; // 找到后返回  
            }  
        }  
    }  

    return null; // 没有找到，返回 null  
}  

/**
 * 新建目录，parentId,treeType:-1、-2
 */
function addMenu(parentId,treeType){
	 var treeNode={id:parentId,title:'根目录'};
	 if(treeType=='-1' && parentId!='-1'){
		 treeNode=findNodeById(treeData[0],parentId);
	 }else if(treeType=='-2' && parentId!='-2'){
		 treeNode=findNodeById(linkData[0],parentId);
     }
		 
	openMenu(treeNode,'新建目录', treeType);
	getMenuTree('#treeSelect', treeType);
}


// 重命名,treeType:-1,-2
function rename(id,treeType){
	openMenuTree(id,'重命名',treeType);
}

// 编辑目录
function editMenu(id,treeType){
	openMenuTree(id,'修改目录',treeType);
}

//移动到
function moveTo(id,treeType){
	openMenuTree(id,'移动到...',treeType);
}

// 复制
function copy(id,treeType){
	if(id){ 
		 $.ajax({
			 url:'#(path)/apidev/api/copy',
	 	 	 	type:"POST",
	 	 	 	data:{'id':id},
	 	 	 	success:function(ret){
		 	 	 	layer.msg(ret.msg);
		 	 	 	if(ret.state=='ok'){
		 	 	 	   getApiTreeList(treeType);
		 	 	 	}  
	 	 	 	}
		 });
	} else {
		layer.msg("id is null");
 	}
}

// 导出
function download(id){
	if(id){ 
		var node=findNodeById(treeData[0],id);
		var url='#(path)/apidev/api/download?id='+id+'&title='+node.title;
		window.open(url);
	} else {
		layer.msg("id is null");
	}
}

// 删除 id,treeType:-1、-2
function del(id,treeType) {
	if(id){
		var treeNode=treeNode=findNodeById(treeData[0],id);
		if(!treeNode){
			treeNode=findNodeById(linkData[0],id);
	    }
	    var nodeType = treeNode.type;
	    var title = treeNode.title;
	    var typeName={menu:'目录',api:'接口',demo:'实例',link:'快捷请求',}
	    var content=`删除${typeName[nodeType]}【${title}】?<br/>
		    ${nodeType=='menu'?`该${typeName[nodeType]}及该${typeName[nodeType]}下的${treeType == '-1' ? '接口和实例':'快捷请求'}`:`该${typeName[nodeType]}`}将移至回收站，30 天后自动彻底删除。`;
	    layer.confirm(content, {icon: 0, title:'提示',offset:'100px',}, function(index){
	    	$.ajax({
				 url:'#(path)/apidev/api/delete',
		 	 	 	type:"POST",
		 	 	 	data:{'id':id},
		 	 	 	success:function(ret){
			 	 	 	layer.msg(ret.msg,{icon:1,offset:'b',anim: 'slideUp'});
			 	 	 	if(ret.state=='ok'){
			 	 	 	   getApiTreeList(treeType);
			 	 	 	}  
		 	 	 	}
			 });
	    	layer.close(index);
	    });
	} else {
		layer.msg("id is null");
	}
}

//打目录树开对话框
function openMenuTree(id,title,treeType){
	var treeNode=findNodeById(treeType=='-1' ? treeData[0] : linkData[0], id);
	openMenu(treeNode,title, treeType);
	if(title!='重命名')
	    getMenuTree('#treeSelect', treeType);
}

// 目录对话框
function openMenu(treeNode,title,treeType){
	var parentNode=findNodeById(treeType=='-1' ? treeData[0] : linkData[0], treeNode.parent_id);
	var showType = 'addData';
    var height="350px";
	if(title=='重命名'){
		showType = 'title';
		height="250px";
	 } else if(title == '移动到...'){
		 showType = 'parentId';
		 height="250px";
	 }else if(title =='修改目录'){
		 showType = 'updateData';
	 }
     
	layer.open({  
	     btnAsync: true,  
	     title: title,  
	     type: 1,  
	     shadeClose: true,
	     content: `  
	         <div class="layui-form layui-form-pane" style="padding:15px;">  
	             <div class="layui-form-item layui-form-text ${showType == 'parentId' ? 'layui-hide':''}">  
	                 <label class="layui-form-label">名称&nbsp;<font color="red">*</font></label>  
	                 <div class="layui-input-block">  
	                     <input type="text" name="title" placeholder="请输入..." lay-verify="required" autocomplete="off" class="layui-input" id="titleInput" value="${showType == 'addData' ? '' : treeNode.title}">  
	                     <div id="titleTip" style="color: red; display: none;position: absolute;left:15px;margin-top: -2px;">名称为必填项，请填写名称</div>  
	                 </div>  
	             </div>  
	             <div class="layui-form-item layui-form-text ${showType == 'title' ? 'layui-hide':''}">  
	                 <label class="layui-form-label">${showType=='parentId'?'目标':'父级'}目录</label>  
	                 <div class="layui-input-block">  
	                  	<input type="hidden" id="treeSelectId" name="parentId" value="${showType == 'updateData' ? parentNode.id:treeNode.id}"/>
	                  	<input type="text" id="treeSelect" name="parentName" placeholder="${showType == 'updateData' ? parentNode.title : treeNode.title}"  class="layui-input" autocomplete="off" onblur="searchMenuBlur()" oninput="searchMenu()"/> 
	                 </div>  
	             </div>  
	         </div>`,  
	 	     area: ['450px', height], 
	 	     offset:'100px',
	 	     delay: [10,500],// 数组成员值分别表示显示延迟时间和隐藏延迟时间
	 	     btn: ['确定', '取消'],  
	 	     btn1: function (index, layero) { 
		 	     
	 	         // 读取输入框内容  
	 	         var title = layero.find('input[name="title"]').val();  
	 	         var titleTip = layero.find('#titleTip');  

	 	         // 验证名称是否填写  
	 	         if (!title && showType !='parentId') {  
	 	             titleTip.show(); // 显示提示信息  
	 	             return false; // 阻止关闭弹出层  
	 	         } else {  
	 	             titleTip.hide(); // 隐藏提示信息  
	 	         }  

	 	     	parentId = layero.find('input[name="parentId"]').val();  
				if(showType=='addData'){
		 	    	saveData(title,parentId,'menu',treeType);
				}else if(showType=='title'){
					updateTitle(treeNode.id,title,treeType);
				} else if(showType=='parentId'){
					updateParentId(treeNode.id,parentId,treeType);
				} else if(showType == 'updateData') {
					updateData(treeNode.id,title,parentId,treeType);
				}
		       
	 	     },  
	 	     btn2: function (index) {  
	 	         layer.close(index); // 关闭弹出层  
	 	     }  
	 	});
}



// 保存目录
function saveData(title,parentId,type,treeType){
	if(title){
		 // 这里可以添加进一步的逻辑，比如提交表单  
		 $.ajax({
			 url:'#(path)/apidev/api/save',
	 	 	 	type:"POST",
	 	 	 	data:{'parent_id':parentId,title:title,type:type},
	 	 	 	success:function(ret){
		 	 	 	layer.msg(ret.msg);
		 	 	 	if(ret.state=='ok'){
		 	 	 	   getApiTreeList(treeType);
		 	 	 	}  
	 	 	 	}
		 });
	} else {
		layer.msg("title is null");
    }
}

// 修改标题
function updateTitle(id,title,treeType){
	if(id && title){
		updateData(id,title,null,treeType);
	} else {
		layer.msg("id or title is null");
   }
}

// 修改父级id
function updateParentId(id,parentId,treeType){
	if(id && parentId){
		updateData(id,null,parentId,treeType);
	} else {
		layer.msg("id or parentId is null");
   }
}

// 修改数据
function updateData(id,title,parentId,treeType){
	if(id){
		 // 这里可以添加进一步的逻辑，比如提交表单  
		 $.ajax({
			 url:'#(path)/apidev/api/update',
	 	 	 	type:"POST",
	 	 	 	data:{'id':id,'title':title,'parent_id':parentId},
	 	 	 	success:function(ret){
		 	 	 	layer.msg(ret.msg);
		 	 	 	if(ret.state=='ok'){
		 	 	 	   getApiTreeList(treeType);
		 	 	 	}  
	 	 	 	}
		 });
	} else {
		layer.msg("id is null");
  }
	
}

 // ele:#treeSelect
function getMenuTree(elemId,treeType){
	$.ajax({
	 	 	url:'#(path)/apidev/api/getTreeList',
	 	 	type:"POST",
	 	 	data:{'parentId':treeType,type:'menu'},
	 	 	success:function(ret){
	 	 		if(ret.state=='ok'){
	 	 			menuData = ret.data;
	 	 			loadMenuTree(menuData,elemId);
	 	 		}
	 	 	}
	 });
}

function loadMenuTree(menuData,elemId){
	var html=createDownMenuTree(menuData,true);		
	  // 绑定输入框
	  layui.dropdown.render({
	    elem: elemId,
	    content:`<div style="max-height:380px;overflow:auto">${html}</div>`,
	    click: function(obj,othis){
	      var nodeId=othis[0].id;
	      var nodeData = findNodeById(menuData[0], nodeId);
	      $(elemId).val(nodeData.title);
	      $('#treeSelectId').val(nodeId);
	    },
	    style: 'min-width: 420px;'
	}); 
}

function searchMenu() {
	titleKeyword = $("input[name=parentName]").val();
	console.log(titleKeyword)
	var filteredData = menuData.map(filterByTitleKeyword).filter(item => item !== null);
	var html=createDownMenuTree(filteredData,true);		
	layui.dropdown.reloadData('treeSelect',{
		content:`<div style="max-height:380px;overflow:auto">${html}</div>`
	});
}

function searchMenuBlur(){
	loadMenuTree(menuData,'#treeSelect');
}

// 项目概况
function project(){
	$.ajax({
		 url:'#(path)/apidev/api/getProjectData',
	 	 type:"POST",
	 	 success:function(ret){
	 		apiData = ret.data.apiData;  
	 	    shortcutData = ret.data.shortcutData;  
	 	    // 读取html
	 	    $.ajax({
	 			 url:'#(path)/apidev/api/project',
	 		 	 type:"POST",
	 		 	 success:function(ret){
	 		 	 	 var contentHtml=ret;
	 				clickMenu('project','<i class="layui-icon layui-icon-layouts"></i>项目概况',contentHtml);
	 		 	 }
	 		});
	 	 }
	});
}

// 回收站
function recycle(){
	$.ajax({
		 url:'#(path)/apidev/api/getRecycleList',
	 	 type:"POST",
	 	 success:function(ret){
	 		apiData = ret.data.apiData;  
	 	    shortcutData = ret.data.shortcutData;  
	 	    // 读取html
	 	    $.ajax({
	 			 url:'#(path)/apidev/api/recycle',
	 		 	 type:"POST",
	 		 	 success:function(ret){
	 		 	 	 var contentHtml=ret;
	 				clickMenu('recycle','<i class="layui-icon layui-icon-delete"></i>回收站',contentHtml);
	 		 	 }
	 		});
	 	 }
	});
}

function reloadRecycleList(){
	$.ajax({
		 url:'#(path)/apidev/api/getRecycleList',
	 	 type:"POST",
	 	 success:function(ret){
	 		apiData = ret.data.apiData;  
	 	    shortcutData = ret.data.shortcutData;  
	 	 }
	});
}

</script>
</body>
</html>